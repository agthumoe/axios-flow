{"version":3,"sources":["../src/index.js"],"names":["pending","type","meta","payload","isPending","AxiosFlow","dispatch","getTokenHeader","token","localStorage","getItem","TOKEN_LABEL","sessionStorage","Authorization","onSuccess","response","onSuccessCallback","params","data","headers","onSuccessHandler","onError","error","onErrorCallback","status","removeItem","onErrorHandler","Api","Error","that","config","prototype","url","action","actionType","_params","post","axios","get","update","put","delete","setTokenLabel","setSuccessHandler","handler","setFailureHandler"],"mappings":"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","file":"index.js","sourcesContent":["import has from \"lodash/has\";\nimport isEmpty from \"lodash/isEmpty\";\nimport axios from \"axios\";\n\nconst pending = (type, meta) => ({\n  type,\n  payload: null,\n  meta: { isPending: true, ...meta },\n});\n\nconst AxiosFlow = (dispatch) => {\n  const getTokenHeader = () => {\n    const token = localStorage.getItem(AxiosFlow.TOKEN_LABEL)\n      ? localStorage.getItem(AxiosFlow.TOKEN_LABEL)\n      : sessionStorage.getItem(AxiosFlow.TOKEN_LABEL);\n\n    if (token) {\n      return { Authorization: `Bearer ${token}` };\n    }\n    return null;\n  };\n\n  const onSuccess = (type, response, onSuccessCallback, meta, params) => {\n    const { data, headers } = response;\n    if (typeof AxiosFlow.onSuccessHandler === \"function\") {\n      AxiosFlow.onSuccessHandler(dispatch, response);\n    }\n    if (type) {\n      dispatch({\n        type,\n        payload: data,\n        meta: { headers, isPending: false, params, ...meta },\n      });\n    }\n\n    if (typeof onSuccessCallback === \"function\") {\n      onSuccessCallback(response);\n    }\n  };\n\n  const onError = (type, error, onErrorCallback) => {\n    if (has(error, \"response.status\") && error.response.status === 401) {\n      sessionStorage.removeItem(AxiosFlow.TOKEN_LABEL);\n      localStorage.removeItem(AxiosFlow.TOKEN_LABEL);\n    }\n    if (typeof AxiosFlow.onErrorHandler === \"function\") {\n      AxiosFlow.onErrorHandler(dispatch, error);\n    }\n    if (type) {\n      dispatch({ type, error: true });\n    }\n    if (typeof onErrorCallback === \"function\") {\n      onErrorCallback(error);\n    }\n  };\n\n  // here\n  function Api() {\n    if (typeof dispatch !== \"function\") {\n      throw Error(\"Please provide a valid dispatch.\");\n    }\n\n    if (AxiosFlow.TOKEN_LABEL === null) {\n      AxiosFlow.TOKEN_LABEL = \"achromex-auth-token\";\n    }\n\n    const that = this;\n    that.config = {};\n\n    // that.instance = _dispatch => new Api(_dispatch);\n\n    Api.prototype.url = (url) => {\n      that.config.url = url;\n      return that;\n    };\n\n    Api.prototype.meta = (meta) => {\n      that.config.meta = meta;\n      return that;\n    };\n\n    Api.prototype.action = (type) => {\n      that.config.actionType = type;\n      return that;\n    };\n\n    Api.prototype.params = (_params) => {\n      if (!isEmpty(_params)) {\n        that.config.params = _params;\n      }\n      return that;\n    };\n\n    Api.prototype.data = (data) => {\n      that.config.data = data;\n      return that;\n    };\n\n    Api.prototype.headers = (headers) => {\n      that.config.headers = headers;\n      return that;\n    };\n\n    Api.prototype.onSuccess = (onSuccessCallback) => {\n      that.config.onSuccessCallback = onSuccessCallback;\n      return that;\n    };\n\n    Api.prototype.onError = (onErrorCallback) => {\n      that.config.onErrorCallback = onErrorCallback;\n      return that;\n    };\n\n    Api.prototype.post = async () => {\n      dispatch(pending(that.config.actionType));\n      try {\n        const response = await axios.post(that.config.url, that.config.data, {\n          headers: { ...getTokenHeader(), ...that.config.headers },\n          params: that.config.params,\n        });\n        onSuccess(\n          that.config.actionType,\n          response,\n          that.config.onSuccessCallback,\n          that.config.meta,\n          that.config.params\n        );\n      } catch (error) {\n        onError(that.config.actionType, error, that.config.onErrorCallback);\n      }\n    };\n\n    Api.prototype.get = async () => {\n      if (that.config.actionType) {\n        dispatch(pending(that.config.actionType, that.config.meta));\n      }\n      try {\n        const response = await axios.get(that.config.url, {\n          headers: { ...getTokenHeader(), ...that.config.headers },\n          params: that.config.params || null,\n        });\n        onSuccess(\n          that.config.actionType,\n          response,\n          that.config.onSuccessCallback,\n          that.config.meta,\n          that.config.params\n        );\n      } catch (error) {\n        onError(that.config.actionType, error, that.config.onErrorCallback);\n      }\n    };\n\n    Api.prototype.update = async () => {\n      dispatch(pending(that.config.actionType));\n      try {\n        const response = await axios.put(that.config.url, that.config.data, {\n          headers: { ...getTokenHeader(), ...that.config.headers },\n          params: that.config.params,\n        });\n        onSuccess(\n          that.config.actionType,\n          response,\n          that.config.onSuccessCallback,\n          that.config.meta,\n          that.config.params\n        );\n      } catch (error) {\n        onError(that.config.actionType, error, that.config.onErrorCallback);\n      }\n    };\n\n    Api.prototype.delete = async () => {\n      dispatch(pending(that.config.actionType));\n      try {\n        const response = await axios.delete(that.config.url, {\n          headers: { ...getTokenHeader(), ...that.config.headers },\n          params: that.config.params || null,\n        });\n        onSuccess(\n          that.config.actionType,\n          response,\n          that.config.onSuccessCallback,\n          that.config.meta,\n          that.config.params\n        );\n      } catch (error) {\n        onError(that.config.actionType, error, that.config.onErrorCallback);\n      }\n    };\n  }\n\n  return new Api();\n};\n\nAxiosFlow.setTokenLabel = (token) => {\n  AxiosFlow.TOKEN_LABEL = token;\n  return AxiosFlow;\n};\n\nAxiosFlow.setSuccessHandler = (handler) => {\n  if (typeof handler === \"function\") {\n    AxiosFlow.onSuccessHandler = handler;\n  } else {\n    throw new Error(\"successHandler must be a function\");\n  }\n  return AxiosFlow;\n};\n\nAxiosFlow.setFailureHandler = (handler) => {\n  if (typeof handler === \"function\") {\n    AxiosFlow.onErrorHandler = handler;\n  } else {\n    throw new Error(\"failureHandler must be a function\");\n  }\n  return AxiosFlow;\n};\n\nexport default AxiosFlow;\n"]}